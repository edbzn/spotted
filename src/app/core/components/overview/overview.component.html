<mat-tab-group [(selectedIndex)]="selectedTab"
  (animationDone)="onTabAnimationDone()"
  class="group">
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="mr"
        [matBadge]="spots.length"
        matBadgePosition="above after">location_on</mat-icon>
      <span>{{ 'overview.spotsAround' | translate }}</span>
    </ng-template>
    <div class="scrollable"
      cdkScrollable
      (scroll)="scrollChanged.emit($event)"
      [@slideInOut]="spots.length"
      *ngIf="initialized; else loading">
      <div *ngFor="let spot of spots; trackBy: trackByFn">
        <spt-spot [spot]="spot"
          (locate)="locate($event)">
        </spt-spot>
      </div>
    </div>
    <ng-template #loading>
      <div class="mt-5 mb-5"
        fxLayoutAlign="center top">
        <mat-spinner></mat-spinner>
      </div>
    </ng-template>
  </mat-tab>
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="mr">add_location</mat-icon>
      {{ 'overview.addSpot' | translate }}
    </ng-template>
    <div class="scrollable"
      cdkScrollable
      (scroll)="scrollChanged.next($event)"
      [class.disabled]="!auth.authenticated">
      <section class="p0"
        *ngIf="auth.authenticated; else authRequired">
        <form [formGroup]="spotForm"
          (submit)="createSpot()"
          novalidate>
          <mat-vertical-stepper class="steps"
            #stepper>
            <mat-step [completed]="descriptionCompleted()">
              <ng-template matStepLabel>{{ 'overview.stepper.description' | translate }}</ng-template>
              <mat-card>
                <mat-card-content>
                  <mat-form-field class="full-width">
                    <input matInput
                      type="text"
                      placeholder="{{ 'overview.form.name' | translate }}"
                      formControlName="name">
                  </mat-form-field>
                </mat-card-content>
              </mat-card>
              <mat-card>
                <mat-card-content>
                  <mat-form-field class="full-width">
                    <mat-select placeholder="Type"
                      formControlName="type">
                      <mat-option *ngFor="let type of types"
                        [value]="type">
                        {{ type }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <mat-form-field class="full-width pb">
                    <mat-select multiple
                      placeholder="Disciplines"
                      formControlName="disciplines">
                      <mat-option *ngFor="let discipline of disciplines"
                        [value]="discipline">
                        {{ discipline }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </mat-card-content>
              </mat-card>
              <mat-card>
                <mat-card-content>
                  <div class="full-width">
                    <mat-slide-toggle formControlName="indoor">
                      {{ 'overview.form.indoor' |Â translate }}
                    </mat-slide-toggle>
                  </div>
                </mat-card-content>
              </mat-card>
              <mat-card>
                <mat-card-subtitle>Difficulty</mat-card-subtitle>
                <mat-card-content>
                  <mat-radio-group class="full-width"
                    formControlName="difficulty">
                    <mat-radio-button class="radio"
                      *ngFor="let difficulty of difficulties"
                      [value]="difficulty">
                      {{ difficulty }}
                    </mat-radio-button>
                  </mat-radio-group>
                </mat-card-content>
              </mat-card>
            </mat-step>
            <mat-step [completed]="media.valid">
              <ng-template matStepLabel>{{ 'overview.stepper.media' | translate }}</ng-template>
              <mat-card class="mb">
                <mat-card-content class="help-card">
                  <mat-icon>photo</mat-icon>
                  <ng-container *ngIf="pictures.length > 0; else noPictureWarning">
                    {{ pictures.length }} photo(s) uploaded
                  </ng-container>
                  <ng-template #noPictureWarning>
                    Please, upload at lease one photo
                  </ng-template>
                </mat-card-content>
              </mat-card>
              <ngu-carousel class="mb"
                [inputs]="carousel"
                [dataSource]="pictures"
                *ngIf="pictures.length > 0; else placeholder">
                <ngu-tile NguCarouselItem
                  *nguCarouselDef="let picture; let i = index"
                  [style.backgroundImage]="'url(' + picture + ')'"
                  class="spot-carousel-item">
                </ngu-tile>
                <button mat-icon-button
                  NguCarouselPrev
                  type="button"
                  class="left-arrow">
                  <mat-icon>arrow_left</mat-icon>
                </button>
                <button mat-icon-button
                  NguCarouselNext
                  type="button"
                  class="right-arrow">
                  <mat-icon>arrow_right</mat-icon>
                </button>
              </ngu-carousel>
              <ng-template #placeholder>
                <div class="spot-carousel-item upload-carousel-item mb">
                  <span>{{ 'overview.form.uploadPlaceholder' | translate }}</span>
                </div>
              </ng-template>
              <div>
                <button (click)="fileInput.click()"
                  type="button"
                  mat-raised-button>
                  <mat-icon>add_to_photos</mat-icon>
                  <span>{{ 'overview.stepper.mediaBtn' | translate }}</span>
                  <input #fileInput
                    accept=".png,.jpg"
                    type="file"
                    multiple="true"
                    (change)="onFileAdded($event)"
                    class="hidden" />
                </button>
              </div>
            </mat-step>
            <mat-step [stepControl]="location"
              [completed]="location.valid">
              <ng-template matStepLabel>{{ 'overview.stepper.location' | translate }}</ng-template>
              <mat-card class="mb">
                <mat-card-content class="help-card">
                  <mat-icon>help</mat-icon> {{ 'overview.help' | translate }}
                </mat-card-content>
              </mat-card>
              <div [formGroup]="location">
                <mat-form-field class="full-width">
                  <input matInput
                    type="address"
                    placeholder="{{ 'overview.form.address' | translate }}"
                    formControlName="address">
                </mat-form-field>
                <mat-form-field class="full-width">
                  <input matInput
                    type="number"
                    placeholder="{{ 'overview.form.latitude' | translate }}"
                    formControlName="latitude">
                </mat-form-field>
                <mat-form-field class="full-width">
                  <input matInput
                    type="number"
                    placeholder="{{ 'overview.form.longitude' | translate }}"
                    formControlName="longitude">
                </mat-form-field>
              </div>
            </mat-step>
            <mat-step [completed]="valid">
              <ng-template matStepLabel>{{ 'overview.stepper.done' | translate }}</ng-template>
              <div class="mb mt">
                <spt-spot [spot]="spotForm.value"
                  *ngIf="media.valid && location.valid && dirty; else withoutPreview"
                  [withActions]="false">
                </spt-spot>
                <ng-template #withoutPreview>
                  <mat-card>
                    <mat-card-content class="help-card">
                      <mat-icon>close</mat-icon> {{ 'overview.withoutPreview' | translate }}
                    </mat-card-content>
                  </mat-card>
                </ng-template>
              </div>
              <button mat-button
                matStepperPrevious>{{ 'overview.form.back' | translate }}</button>
              <button mat-button
                class="mr"
                type="button"
                (click)="reset()">
                {{ 'overview.form.reset' | translate }}
              </button>
              <button mat-raised-button
                [disabled]="!valid"
                color="primary"
                type="submit">
                {{ 'overview.form.submit' | translate }}
              </button>
            </mat-step>
          </mat-vertical-stepper>
        </form>
      </section>
      <ng-template #authRequired>
        <div class="auth-required"
          fxLayoutAlign="center center">
          <h1 class="mat-title mt-5">Authentication required</h1>
        </div>
      </ng-template>
    </div>
  </mat-tab>
</mat-tab-group>
